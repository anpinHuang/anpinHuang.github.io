<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Basel II, ASRF Model &amp; IFRS 9 Application</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/bootstrap.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-DH9DRW0BMM"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-DH9DRW0BMM');
</script>


<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-222711575-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-222711575-1');
</script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}

.tocify-subheader {
  display: inline;
}
.tocify-subheader .tocify-item {
  font-size: 0.95em;
}

</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row-fluid">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Ben Huang</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
<li>
  <a href="about.html">About me</a>
</li>
<li>
  <a href="econometrics.html">Econometrics</a>
</li>
<li>
  <a href="dataScienceML.html">Data Science</a>
</li>
<li>
  <a href="Finance.html">Financial Math &amp; Credit Models</a>
</li>
<li>
  <a href="Programming.html">Programming</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Basel II, ASRF Model &amp; IFRS 9 Application</h1>

</div>


<p>This page is my summary of notes on Basel II and the ASRF model from various external sources and literatures including the regulatory documents:</p>
<ul>
<li><a href="https://www.bis.org/bcbs/irbriskweight.pdf">An Explanatory Note on the Basel II IRB Risk Weight Functions</a></li>
<li><a href="https://pdfs.semanticscholar.org/71e1/13295d22c5ba474cffa53baef822fb029d52.pdf">Theory behind regulatory Capital Formulae</a></li>
<li><a href="https://www.bis.org/bcbs/publ/d424.pdf">Basel III: Finalising post-crisis reforms</a><br />
</li>
<li><a href="https://www.bis.org/publ/bcbs128.pdf">International Convergence of Capital Measurement and Capital Standards</a></li>
</ul>
<div id="basel-requirements" class="section level3">
<h3>1. Basel Requirements</h3>
<p>Unlike CECL and IFRS 9, the accounting standards for allowance on credit loss that focus on lifetime of the loan, the Basel rule focues on the <strong>yearly (12-month)</strong> loss for calculating the regulatory capital. And, unlike CECL and IFRS 9 that requires loss estimation based on point-in-time (PIT) which requires forwarding looking forecast, the Basel rule requires <strong>through-the-cycle (TTC)</strong> loss forecast over the next 12 months. <strong>Portfolio-invariant</strong> is required under the Basel rule.</p>
<p>As mentioned in <span class="citation">(Basel Committee on Banking Supervision <a href="#ref-BASEL2">2005</a>)</span>, “one of the functions of bank capital is to provide a buffer to protect a bank’s debt holders against peak losses that exceed expected levels”, i.e. the Unexpected Loss (UL).</p>
<ul>
<li><strong>Expected Loss (EL)</strong>: The expected value of the loss over the next 12 month</li>
<li><strong>Unexpected Loss (UL)</strong>: Losses above the Expected Loss (EL)</li>
<li><strong>Value-at-Risk (VaR)</strong>: EL + UL</li>
</ul>
</div>
<div id="the-mertons-model" class="section level3">
<h3>2. The Merton’s Model</h3>
<p>The Merton’s model leverage the <strong>Black-Scholes</strong> model used in option pricing. Similar to option pricing that the option’s value being the surplus between stock price and the strike price, the value of a loan is the surplus between the underlying company’s total assets and its total liabilities. The logic is that the loan defaults when the company’s total assets cannot support its total liabilities. The evolution of the asset value <span class="math inline">\(A\)</span> is log-normmally distributed as the stock price in Black Scholes. The industry practice is to use Merton’s model to estimate PD for corporation, and use logistic regression type model to estimate PD for retail exposures.</p>
<p>Stochastic differential equation (SDE) of a firm’s assets: <span class="math display">\[dA = (\mu A )dt + \sigma AdW(t)\]</span></p>
<p>Apply <a href="ItoLemma.html"><strong>Ito’s lemma</strong></a> for <span class="math inline">\(g(x) = ln(x)\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
dg(A) &amp;= d(ln(A))\\
&amp;= \frac{1}{A}dA + \frac{1}{2} \frac{-1}{A^2} (dA)^2 \\
&amp;= \mu dt + \sigma dW(t) - \frac{1}{2A^2} [(\mu A)^2(dt)^2 + 2(\mu A)dt\sigma AdW(t) + \sigma^2 (dW(t))^2] \\
&amp;= \mu dt + \sigma dW(t) - \frac{1}{2A^2} [0 + 0 + \sigma^2A^2dt]\\
&amp;= \mu dt + \sigma dW(t) - \frac{1}{2} \sigma^2dt\\
&amp;= (\mu - \frac{1}{2}\sigma^2)dt + \sigma dW(t) \\
\end{aligned}
\]</span></p>
<p><span class="math display">\[ln(A_t) = ln(A_0) + \int_{0}^{t} (\mu - \frac{1}{2}\sigma^2)dt + \sigma dW(t)\]</span></p>
<p><span class="math display">\[
\begin{aligned}
A_t &amp;= A_0 \cdot e^{(\mu - \frac{1}{2}\sigma^2)dt + \sigma dW(t)} \\
&amp;= A_0 \cdot e^{(\mu - \frac{1}{2}\sigma^2)t + \sigma \sqrt{t}X(t)} 
\end{aligned}
\]</span> where <span class="math inline">\(X_t \sim \mathcal{N}(0,1)\)</span> or <span class="math inline">\(\Phi\)</span></p>
<p>The probability of default (not risk-neutral, but physical world and therefore <span class="math inline">\(\mu\)</span> is used instead of <span class="math inline">\(r\)</span>) can be expressed as</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal{P}[A_i(T)&lt;L_i] &amp;= \mathcal{P}[A_i(0) \cdot e^{(\mu_i - \frac{1}{2}\sigma_i^2)T + \sigma_i \sqrt{T}X_i(T)}&lt;L_i]\\
&amp;= \mathcal{P}[X_i(T)&lt;\frac{ln(L_i)-ln(A_i(0))-(\mu_i-\frac{\sigma_i^2}{2})T}{\sigma_i \sqrt{T}}] \\
&amp;= \mathcal{P}[X_i(T)&gt;\frac{ln(A_i(0))-ln(L_i)+(\mu_i-\frac{\sigma_i^2}{2})T}{\sigma_i \sqrt{T}}] \\
&amp;= 1-\Phi(d2) \\
&amp;= \Phi(-d2)
\end{aligned}
\]</span> where <span class="math inline">\(L_i\)</span> is the total liabilities of company <span class="math inline">\(i\)</span>, and</p>
<p><span class="math display">\[d_2 = \frac{ln(A_i(0))-ln(L_i)+(\mu_i-\frac{\sigma_i^2}{2})T}{\sigma_i \sqrt{T}}\]</span></p>
<p>Note that unlike Black-Scholes which is under the risk-neutral measure, the Merton model here is under physical measure.</p>
</div>
<div id="asrf-model" class="section level3">
<h3>3. ASRF Model</h3>
<p>The Merton’s model can be extended to <strong>Asymptotic Single Risk Factor model (ASRF)</strong>, assuming the assets value of any single borrowing company is correlated that of any other company with correlation <span class="math inline">\(\rho\)</span> ASRF model is portfolio-invariant. <span class="citation">(Juulia Happonen <a href="#ref-ASRF16">2016</a>)</span> provides the derivation of ASRF model (also show in below).</p>
<p>The asset value of company <span class="math inline">\(i\)</span> is driven by a single factor <span class="math inline">\(Z\)</span> that represents the systemic credit risk. The idiosyncretic risk should already diversified.</p>
<p><span class="math display">\[X_i = aZ+b \epsilon_i\]</span> where both <span class="math inline">\(Z\)</span> and <span class="math inline">\(\epsilon\)</span> follow standard normal distribution and <span class="math inline">\(Z\)</span> is independent of <span class="math inline">\(\epsilon\)</span> and each of <span class="math inline">\(\epsilon_i\)</span> for <span class="math inline">\(i=1,...,n\)</span> is independent of each other</p>
<p>To find <span class="math inline">\(a\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
\rho = cor(X_i, X_j) &amp;= \frac{Cov(X_i, X_j)}{\sigma_{X_i}\sigma_{X_j}} \\
&amp;= \frac{E[X_iX_j] - E[X_i]E[X_j]}{1\cdot 1} \\
&amp;= E[(aZ+b_i\epsilon_i)(aZ+b_j\epsilon_j)] - 0 \\
&amp;= E[a^2Z^2+ab_iZ\epsilon_i+ab_jZ\epsilon_j+b_ib_j\epsilon_i\epsilon_j] \\
&amp;= a^2E[Z^2] + ab_iE[Z]E[\epsilon_i] + ab_jE[Z]E[\epsilon_j] + b_ib_jE[\epsilon_i]E[\epsilon_j] \\
&amp;= a^2E[Z^2] + 0\\
&amp;= a^2(Var(Z)+E[Z]^2) = a^2
\end{aligned}
\]</span> The parameter <span class="math inline">\(a\)</span> is then therefore <span class="math inline">\(\sqrt{\rho}\)</span>.</p>
<p>Then to find <span class="math inline">\(b\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
Var(X_i) &amp;= E[X_i^2] - E[X_i]^2 \\
&amp;= E[(aZ+b_i\epsilon_i)^2] - a^2 \\
&amp;= a^2E[Z^2] + 2abE[Z]E[\epsilon_i] + b_i^2E[\epsilon_i^2] \\
&amp;= a^2E[Z^2] +0+b_i^2 \\
&amp;= a^2+b^2 = \rho+b_i^2\\
\end{aligned}
\]</span> Given that <span class="math inline">\(Var(X_i) = 1\)</span>, we obtain that <span class="math inline">\(b_i^2 = \sqrt{1-\rho}\)</span>. With <span class="math inline">\(a = \sqrt{\rho}\)</span> and <span class="math inline">\(b_i = \sqrt{1-\rho}\)</span> as shown in above, we can now write <span class="math inline">\(X_i\)</span> as:</p>
<p><span class="math display">\[X_i = \sqrt{\rho} \cdot Z + \sqrt{1-\rho} \cdot \epsilon_i\]</span> Now we want to derive the <strong>conditional default probability</strong> given the information of systematic credit risk <span class="math inline">\(Z\)</span>.</p>
<p><span class="math display">\[
\begin{aligned}
\mathcal{P}(A_i(T)&lt;L_i) &amp;= \mathcal{P}(X_i(T)&lt;-d_2)\\
&amp;=  \mathcal{P}(\sqrt{\rho} \cdot Z + \sqrt{1-\rho} \cdot \epsilon_i &lt; -d_2) \\
&amp;=  \mathcal{P}(\epsilon_i &lt; \frac{-d_2-\sqrt{\rho} \cdot Z}{\sqrt{1-\rho}}) \\
&amp;=  \Phi(\frac{-d_2-\sqrt{\rho} \cdot Z}{\sqrt{1-\rho}}) \\
&amp;=  \Phi(\frac{\Phi^{-1}(PD_i^{*}) -\sqrt{\rho} \cdot Z}{\sqrt{1-\rho}}) \\
\end{aligned}
\]</span> where <span class="math inline">\(PD_i^{*}\)</span> is the <strong>unconditionally default probability (PD)</strong>, or the through-the-cycle (TTC) PD and <span class="math inline">\(\Phi^{-1}(PD_i^{*})\)</span> is the thresold for default by taking the inverse of standard normal distribution.</p>
<p>The credit loss:</p>
<p><span class="math display">\[Loss = I \cdot EAD \cdot LGD\]</span> where <span class="math inline">\(I\)</span> is the indicator function of default.</p>
<ul>
<li><span class="math inline">\(I=1\)</span>, when <span class="math inline">\(X_i &lt; \Phi^{-1}(PD_i)\)</span> (the probability is equivalent to <span class="math inline">\(A_i(T) &lt; L_i\)</span> as shown in the above)</li>
<li><span class="math inline">\(I=0\)</span>, otherwise</li>
</ul>
<p>The conditional expected value of the default indicator given the systemic credit risk variable is:</p>
<p><span class="math display">\[E[I_i|Z] = \Phi(\frac{\Phi^{-1}(PD_i^{*})-\sqrt{\rho}Z}{\sqrt{1-\rho}})\]</span></p>
<p>Assuming PD, EAD and LGD are independent, then the expected loss (EL) for the portfolio is:</p>
<p><span class="math display">\[E[L_p|Z] = \sum_{i=1}^{n} EAD_i \cdot LGD_i \cdot \mathcal{N}(\frac{\Phi^{-1}(PD_i^{*})-\sqrt{\rho}Z}{\sqrt{1-\rho}})\]</span></p>
<p>Now we can calculate the value-at-risk (VaR) given a specified condifence level <span class="math inline">\(\alpha\)</span>:</p>
<p><span class="math display">\[VaR(\alpha) = \sum_{i=1}^{n} EAD_i \cdot LGD_i \cdot \Phi(\frac{\Phi^{-1}(PD_i^{*})-\sqrt{\rho} \cdot \Phi^{-1}(1-\alpha)}{\sqrt{1-\rho}})\]</span> In practice,</p>
<ul>
<li>The asset correlation <span class="math inline">\(\rho\)</span> can be calibrated by observing correlations in the market or from historical default data.</li>
<li><p>The Basel rules for calculating the correlation <span class="math inline">\(\rho\)</span> are:</p>
<ul>
<li>Corporate, sovereign and bank exposure:</li>
<li>Small- and medium-sized entities (SMEs):</li>
</ul>
<span class="math display">\[\rho = 0.12 × (1 – e{-50 × PD}) / (1 – EXP(-50)) +
0.24 × [1 – (1 – EXP(-50 × PD)) / (1 – EXP(-50))] \]</span></li>
<li><p>To derive <span class="math inline">\(PD_i^{*}\)</span> we need <span class="math inline">\(\mu\)</span> the instantenious expected rate of return of the asset value of company <span class="math inline">\(i\)</span></p></li>
</ul>
</div>
<div id="estimate-asset-correlation-rho" class="section level3">
<h3>4. Estimate asset correlation <span class="math inline">\(\rho\)</span></h3>
<p>The asset correlation <span class="math inline">\(\rho\)</span> can be estimated from the default rate. Following the equation above:</p>
<p><span class="math display">\[
\begin{aligned}
PD_{PiT} &amp;= \mathcal{P}(A_i(T)&lt;L_i)\\
&amp;=  \Phi(\frac{\Phi^{-1}(PD_i^{*}) -\sqrt{\rho} \cdot Z}{\sqrt{1-\rho}}) \\
\end{aligned}
\]</span></p>
<p>again, the <span class="math inline">\(PD_{i}^*\)</span> is the <span class="math inline">\(PD_{TtC}\)</span>.</p>
<p>Then,</p>
<p><span class="math display">\[
\begin{aligned}
\Phi^{-1}(PD_{PiT}) &amp;= \frac{\Phi^{-1}(PD_i^{*}) -\sqrt{\rho} \cdot Z}{\sqrt{1-\rho}} \\
 Var [\Phi^{-1}(PD_{PiT})]&amp;=  Var[\frac{\Phi^{-1}(PD_i^{*}) -\sqrt{\rho} \cdot Z}{\sqrt{1-\rho}}] \\
 Var [\Phi^{-1}(PD_{PiT})] &amp;= \frac{1}{1-\rho} Var[\Phi^{-1}(PD_i^{*})] + \frac{\rho}{1-\rho} \cdot 1 \\
 Var [\Phi^{-1}(PD_{PiT})] &amp;=  \frac{\rho}{1-\rho} \\
 Var [\Phi^{-1}(PD_{PiT})] - \rho Var [\Phi^{-1}(PD_{PiT})] &amp;=  \rho \\
  \rho (1+ Var[\Phi^{-1}(PD_{PiT})]) &amp;= Var [\Phi^{-1}(PD_{PiT})]\\
  \rho &amp;= \frac{Var [\Phi^{-1}(PD_{PiT})]}{1+Var [\Phi^{-1}(PD_{PiT})]} \\
\end{aligned}
\]</span> assuming the <span class="math inline">\(PD_{TtC}\)</span> (or <span class="math inline">\(PD_i^{*}\)</span>) is constant, then <span class="math inline">\(Var[\Phi^{-1}(PD_{TtC})]=0\)</span></p>
<p>If there are multiple ratings in the pool, then <span class="math inline">\(PD_{TtC}\)</span> of the portfolio is not constant (portfolio changes over time). Therefore, <span class="math inline">\(\rho\)</span> would need to be estimated by maximum likelihood in this case.</p>
<pre class="r"><code>avg_IRB_PD &lt;- c(0.0458, 0.0452, 0.0442, 0.0455, 0.0456, 0.0468, 0.045, 0.0454, 0.0463, 0.0457
                , 0.0464, 0.0456, 0.045,0.0441, 0.0426, 0.0412, 0.0402, 0.0387, 0.0380, 0.0358
                , 0.0335, 0.0327, 0.0322, 0.0311, 0.0301, 0.0290, 0.0286, 0.0274)
default_rate &lt;- c(0.0581, 0.0578, 0.0547, 0.0563, 0.0579, 0.0532, 0.0509, 0.0556, 0.0655, 0.0666
                  , 0.0525, 0.0432, 0.0273, 0.0243, 0.0214, 0.0196, 0.02, 0.0193,0.0230, 0.0250
                  , 0.0312, 0.0336, 0.0352,0.0355, 0.0325, 0.0359, 0.0373, 0.0335)
empirical_q &lt;- rank(default_rate)/(length(default_rate)+1)

Vasicek_PDF &lt;- function(PiT, IRB, AC) {
  Vasicek_PDF &lt;- sqrt((1-AC)/AC) * exp(0.5*(qnorm(PiT)^2 - ( ( sqrt(1-AC)*qnorm(PiT)-qnorm(IRB))/sqrt(AC))^2) )
}
Vasicek_CDF &lt;- function(PiT, IRB, AC) {
  Vasicek_CDF &lt;- (1-pnorm(-qnorm(PiT)*sqrt(1-AC)-qnorm(IRB)/sqrt(AC)) )
}
Vasicek_ICDF &lt;- function(CI, IRB, AC) {
  Vasicek_ICDF &lt;- pnorm( (qnorm(IRB)-sqrt(AC)*qnorm(1-CI)) /sqrt(1-AC) )
}
rho_candidate &lt;- seq(0.01,0.05,0.0001)
calibration_process &lt;- as.data.frame(matrix(NA, nrow=length(rho_candidate), ncol=2))
for(i in 1:length(rho_candidate)) {
  sum_loglikelihood &lt;- sum(log(Vasicek_PDF(PiT = default_rate, IRB = avg_IRB_PD, rho_candidate[i])))
  calibration_process[i,1] &lt;- rho_candidate[i]
  calibration_process[i,2] &lt;- sum_loglikelihood 
}
rho &lt;- calibration_process[which(calibration_process[,2]==max(calibration_process[,2])),1]
PiT_empirical_q &lt;- Vasicek_ICDF(CI=empirical_q, IRB=avg_IRB_PD, AC=rho)
plot(avg_IRB_PD, type=&#39;l&#39;, ylim=c(0,0.1), ylab = &quot;PD&quot;, xlab = &quot;Period&quot;)
lines(default_rate, col=&#39;red&#39;)
lines(PiT_empirical_q, col=&#39;orange&#39;)
legend(x=16, y=0.1, c(&quot;IRB TtC PD&quot;, &quot;Observed Default rate&quot;,&quot;PiT empirical quantile&quot;),col=c(&quot;black&quot;,&quot;red&quot;,&quot;orange&quot;),lty=c(1,1,1))</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<pre class="r"><code>cat(paste0(&quot;The calibrated asset correlation is: &quot;,rho*100,&quot;% \n&quot;))</code></pre>
<pre><code>## The calibrated asset correlation is: 2.61%</code></pre>
</div>
<div id="ifrs9-requirement-and-use-of-asrf-model" class="section level3">
<h3>5. IFRS9 requirement and use of ASRF model</h3>
<p>The main feature of the IFRS9 requirement is the point-in-time (PiT) risk parameters, i.e. the PD, EAD or LGD should reflect the current &amp; future economic condition as opposed to the through-the-cycle (TtC) risk parameters. The ASRF model discussed in the above section can also be used in the IFRS 9 as <span class="math inline">\(z\)</span> (standard normal distribution) represents the single systemetic credit risk factor.</p>
</div>
<div id="binomial-confidence-bound-of-irb-pd" class="section level3">
<h3>6. Binomial confidence bound of IRB PD</h3>
<p>To make the PiT adjustment for PD, we have to first assume that the flunctuation of the observed default rate is a reflection of the economic condition as opposed to random noise around the TtC PD. Based on the IRB PD (12 month), we can construct the binomial confidence bound around it.</p>
<p>The figures below show the binomial confidence bound for n=1000 and n=20000. The greater the observation size, the smaller the bound. In other words, we need to have enough data to ensure that we are not model random noise if we were to link macroeconomic factor for the PiT adjustment. It’s likely not achievable for wholesale portfolio where the number of observations is limited and the expert judgement is required macroeconomic PiT adjustment.</p>
<p>The below example is an simplied case. The average IRB PD can be different per period as the portfolio compisition changes and so does the number of observations per period.</p>
<pre class="r"><code>binomial_bounds &lt;- function(static_size) {
  n &lt;- rep(static_size, 25)
  odr &lt;- c(0.024,0.025,0.024,0.022,0.023
  ,0.025,0.023,0.021,0.022,0.024
  ,0.023,0.021,0.021,0.023,0.021
  ,0.019,0.019,0.021,0.020,0.019
  ,0.020,0.022,0.022,0.022,0.023)
  IRB_PD &lt;- rep(mean(odr),25)
  down_bound &lt;- rep(qbinom(0.025, static_size,IRB_PD[1])/static_size,25)
  up_bound &lt;- rep(qbinom(0.975, static_size,IRB_PD[1])/static_size,25)
  plot(IRB_PD, type=&#39;l&#39;, ylim = c(0.01,0.04))
  lines(odr, col=&#39;red&#39;)
  lines(down_bound, lty=2)
  lines(up_bound,lty=2)
}

binomial_bounds(static_size=1000)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<pre class="r"><code>binomial_bounds(static_size=20000)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-2-2.png" width="672" /></p>
</div>
<div id="rho-and-pit-pd-distribution-shape" class="section level3">
<h3>7. <span class="math inline">\(\rho\)</span> and PiT PD distribution shape</h3>
<p>The histagrams shows that as the <span class="math inline">\(\rho\)</span> increase, the distribution becomes more flat tailed.</p>
<pre class="r"><code>rho &lt;- c(0.02,0.07,0.18)
ttc &lt;- 0.05
n &lt;- 2000
z &lt;- rnorm(n, mean=0, sd=1)
pit &lt;- matrix(nrow=n,ncol=3)
for(i in 1:n){
  pit[i,1] &lt;- pnorm((qnorm(ttc)-sqrt(rho[1])*z[i])/sqrt(1-rho[1]),0,1)
  pit[i,2] &lt;- pnorm((qnorm(ttc)-sqrt(rho[2])*z[i])/sqrt(1-rho[2]),0,1)
  pit[i,3] &lt;- pnorm((qnorm(ttc)-sqrt(rho[3])*z[i])/sqrt(1-rho[3]),0,1)
}

hist(pit[,1], breaks=40,freq=FALSE, ylim=c(0,40), xlim=c(0,0.25), xlab=&#39;PiT PD&#39;, main = &#39;rho = 2%&#39;)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-3-1.png" width="672" /></p>
<pre class="r"><code>hist(pit[,2], breaks=40, freq=FALSE, ylim=c(0,40), xlim=c(0,0.25), xlab=&#39;PiT PD&#39;, main = &#39;rho = 7%&#39;)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-3-2.png" width="672" /></p>
<pre class="r"><code>hist(pit[,3], breaks=50, freq=FALSE, ylim=c(0,40), xlim=c(0,0.25), xlab=&#39;PiT PD&#39;, main = &#39;rho = 18%&#39;)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-3-3.png" width="672" /></p>
</div>
<div id="pd_ttc-and-variability" class="section level3">
<h3>8. <span class="math inline">\(PD_{TtC}\)</span> and variability</h3>
<p>The histagram shows that the shape of PiT PD distributions are quite different given the same <span class="math inline">\(\rho\)</span> but different <span class="math inline">\(PD_{TtC}\)</span>. Therefore, for different PD rating <span class="math inline">\(r_{i}\)</span> (different <span class="math inline">\(PD_{TtC}\)</span>), the <span class="math inline">\(\rho_{r_i}\)</span> should be different to have the same shape.</p>
<pre class="r"><code>rho &lt;- 0.075
ttc &lt;- c(0.02,0.05,0.24)
n &lt;- 2000
z &lt;- rnorm(n, mean=0, sd=1)
pit &lt;- matrix(nrow=n,ncol=3)
for(i in 1:n){
  pit[i,1] &lt;- pnorm((qnorm(ttc[1])-sqrt(rho)*z[i])/sqrt(1-rho),0,1)
  pit[i,2] &lt;- pnorm((qnorm(ttc[2])-sqrt(rho)*z[i])/sqrt(1-rho),0,1)
  pit[i,3] &lt;- pnorm((qnorm(ttc[3])-sqrt(rho)*z[i])/sqrt(1-rho),0,1)
}

hist(pit[,1], breaks=40, freq=FALSE, ylim=c(0,50), xlim=c(0,0.25), xlab=&#39;PiT PD&#39;, main = &#39;TtC = 2.5%&#39;)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<pre class="r"><code>hist(pit[,2], breaks=40, freq=FALSE, ylim=c(0,20), xlim=c(0,0.25), xlab=&#39;PiT PD&#39;, main = &#39;TtC = 5%&#39;)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-4-2.png" width="672" /></p>
<pre class="r"><code>hist(pit[,3], breaks=40, freq=FALSE, ylim=c(0,6), xlim=c(0,0.6), xlab=&#39;PiT PD&#39;, main = &#39;TtC = 12.5%&#39;)</code></pre>
<p><img src="ASRF_files/figure-html/unnamed-chunk-4-3.png" width="672" /></p>
</div>
<div id="pit-adjustment-for-non-default-rating-migration" class="section level3">
<h3>9. PiT adjustment for non-default rating migration</h3>
<p>With the TtC rating migration matrix, and PiT adjustment for default probability are established, the next step is the PiT adjustment for non-default rating migration.</p>
<p><span class="math display">\[MP^{PiT}_{r \to d} = F^{-1}_{PD}(MP^{TtC}_{r \to d};\rho_r;PiC)\]</span></p>
<ul>
<li>where <span class="math inline">\(r\)</span> is the rating,</li>
<li><span class="math inline">\(d\)</span> is the default state (rating) and</li>
<li><span class="math inline">\(MP^{PiT}_{r \to d}\)</span> is the PiT migration probability from rating <span class="math inline">\(r\)</span> to default <span class="math inline">\(d\)</span>, and is therefore also <span class="math inline">\(PD_{PiT}\)</span>.</li>
<li><p><span class="math inline">\(F^{-1}_{PD}\)</span> is the inverse of Vasick distribution. recall that <span class="math inline">\(\Phi(\frac{\Phi^{-1}(PD_i^{*}) -\sqrt{\rho} \cdot Z}{\sqrt{1-\rho}})\)</span></p></li>
<li><span class="math inline">\(MP^{TtC}_{r \to d}\)</span> refers to the <span class="math inline">\(PD_i^{*}\)</span> in the previous equation</li>
<li><p><span class="math inline">\(PiC\)</span> refers to the standard normal <span class="math inline">\(Z\)</span> in the previous equation, but in here, it would be an actual number between 0 and 1 presribed by the economic scenario.</p></li>
</ul>
<p>We can then derive the migration probability from <span class="math inline">\(r\)</span> to one rating above default <span class="math inline">\(d-1\)</span>:</p>
<p><span class="math display">\[
\begin{aligned}
MP^{PiT}_{r \to d-1} &amp;=  MP^{PiT}_{r \to \{d,d-1\}} - MP^{PiT}_{r \to d}\\
 &amp;= F^{-1}_{PD}(MP^{TtC}_{r \to \{d, d-1\}};\rho_r;PiC) - F^{-1}_{PD}(MP^{TtC}_{r \to d};\rho_r;PiC)\\
\end{aligned}
\]</span></p>
<p>so on and so forth, we can derive the migration probability of <span class="math inline">\(r \to c\)</span> where <span class="math inline">\(c\)</span> is any non-default rating.</p>
</div>
<div id="portfolio-invariance" class="section level3">
<h3>10. Portfolio Invariance</h3>
</div>
<div id="irb-approaches" class="section level3">
<h3>11. IRB Approaches</h3>
<p>Alternative to the <strong>Standard Approach (SA)</strong>, the Basel II also allows banks to use <strong>Internal Ratings-Based (IRB)</strong> approach to measure the risk parameters (PD, EAD and/or LGD) for Risk weighted Asset (RWA) calculation.</p>
<ul>
<li><strong>Foundation IRB Approach (FIRB)</strong>: The bank uses its own estimated PD but rely on supervisory estimates for other risk components. (There is no distinction between a foundation and advanced approach for retail exposure, banks must provide their own PD, EAD and LGD.)</li>
<li><strong>Advanded IRB Approach (AIRB)</strong>: The bank uses its own estimaed PD, EAD, LGD and effective duration (M).</li>
</ul>
</div>
<div id="references" class="section level3 unnumbered">
<h3>12. References</h3>
<div id="refs" class="references">
<div id="ref-BASEL2">
<p>Basel Committee on Banking Supervision. 2005. <em>An Explanatory Note on the Basel Ii Irb Risk Weight Functions</em>. <a href="https://www.bis.org/bcbs/irbriskweight.pdf">https://www.bis.org/bcbs/irbriskweight.pdf</a>.</p>
</div>
<div id="ref-ASRF16">
<p>Juulia Happonen. 2016. <em>Theory Behind Regulatory Capital Formulae</em>. <a href="https://aaltodoc.aalto.fi/bitstream/handle/123456789/22834/master_Happonen_Juulia_2016.pdf?sequence=1&amp;isAllowed=y">https://aaltodoc.aalto.fi/bitstream/handle/123456789/22834/master_Happonen_Juulia_2016.pdf?sequence=1&amp;isAllowed=y</a>.</p>
</div>
</div>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->

<script>
$(document).ready(function ()  {

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = false;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
